/**
 * Video Player MPD/M3U8/M3U/EPG
 *
 * @author Sharkiller
 * @license Video Player MPD/M3U8/M3U/EPG Â© 2023 by Sharkiller is licensed under CC BY-NC-ND 4.0.
 * To view a copy of this license, visit https://creativecommons.org/licenses/by-nc-nd/4.0/
 */
!function(){document.querySelector("html").setAttribute("lang",chrome.i18n.getMessage("@@ui_locale"));let s={autoLowLatency:!0,audioLang:"es",compressorEnabled:!1,customWV:!1,customWV_data:"",customCK:!1,customCK_data:"",extra:{clearkeys:!1}},r="";window.urlCk=!1;let a=new URL(window.location.href);if(""!==a.hash){let t=new URL(a.hash.slice(1));["ck","wv","wvc","data","headers","title","image","manifest_type"].forEach(e=>{t.searchParams.delete(e)}),r=t.href,a=new URL(a.hash.slice(1))}var e=chrome.runtime.getManifest();let t={playlist:[{sources:[{file:r,default:!0}]}],width:"100%",height:"100%",stretching:"uniform",aspectratio:"16:9",autostart:!0,preload:"auto",liveSyncDuration:5,liveTimeout:0,playbackRateControls:!0,abouttext:e.name+" v"+e.version,aboutlink:"https://chrome.google.com/webstore/detail/"+chrome.runtime.id,skin:{name:"extension",url:"player.min.css"}};function o(e){e=e.replaceAll("-","+").replaceAll("_","/");let t=atob(e),a=(t=t.split(""),"");return t.forEach(e=>{a+=e.codePointAt(0).toString(16).padStart(2,"0")}),a}function n(e){if(/[ {"']*([0-9a-f]{32})[ "']*:[ "']*([0-9a-f]{32})[ }"']*/i.test(e)){var t={};for(const a of e.matchAll(/[ {"']*([0-9a-f]{32})[ "']*:[ "']*([0-9a-f]{32})[ }"']*/gi))t[a[1]]=a[2];return t}return!1}function c(e){let a={};try{a=JSON.parse(e)}catch(e){return!1}if(Array.isArray(a?.keys)){let t={};return a.keys.forEach(e=>{t[o(e.kid)]=o(e.k)}),t}return!1}function i(e){var t,a=n(e);return(a||!!(a=c(e)))&&(t=Object.entries(a)[0],s.extra.clearkeys={drm:{clearKeys:a}},{clearkey:{keyId:t[0],key:t[1]}})}function l(e){var t,e=e.trim();return/^https?/.test(e)?!1===(t=function(e){var t=new XMLHttpRequest;try{if(t.open("GET",e,!1),t.send(),200!==t.status)return!1;if(!1===n(t.responseText)&&!1===c(t.responseText))return!1}catch(e){return!1}return t.responseText}(e))?(window.urlCk=e,!!/m3u8/i.test(r)&&{clearkey:{keyId:"",key:""}}):i(t):i(e)}if(window.getLicense=e=>{var t=new XMLHttpRequest;t.open("POST",window.urlCk,!1);try{t.send(e)}catch(e){return!1}return 200===t.status&&t.responseText},a.searchParams.has("ck")){e=a.searchParams.get("ck");try{!1!==(e=l(window.atob(e)))&&(t.playlist[0].sources[0].drm=e)}catch(e){e instanceof DOMException||0 instanceof SyntaxError}}document.addEventListener("hlsdataReady",()=>{var e;a.searchParams.has("wv")&&(e=a.searchParams.get("wv").replace(" ","+"),e=window.atob(e),hlsdata.config.drmSystems={"com.widevine.alpha":{licenseUrl:e}},hlsdata.config.drmSystemOptions={audioRobustness:"SW_SECURE_CRYPTO",videoRobustness:"SW_SECURE_CRYPTO"},hlsdata.config.emeEnabled=!0)}),document.addEventListener("shakadataReady",()=>{shakadata.shakaPlayer.configure({preferredAudioLanguage:s.audioLang,preferredTextLanguage:s.audioLang,streaming:{autoLowLatencyMode:s.autoLowLatency}});var e=a.searchParams.has("wv");if(e)try{var t=a.searchParams.get("wv").replace(" ","+"),t=window.atob(t);let e="";a.searchParams.has("wvc")&&(e=a.searchParams.get("wvc").replace(" ","+"),e=window.atob(e)),shakadata.shakaPlayer.configure({drm:{servers:{"com.widevine.alpha":t},advanced:{"com.widevine.alpha":{videoRobustness:"SW_SECURE_CRYPTO",audioRobustness:"SW_SECURE_CRYPTO",serverCertificateUri:e}}}})}catch(e){0 instanceof DOMException}else if(s.customWV){let t=!1,a=!1;if(s.customWV_data.split(/\r?\n/).forEach(e=>{var e=e.trim();0<e.length&&(e=e.split(">"),RegExp(e[0],"i").test(r))&&3===(t=e).length&&"ck"===e[2]&&(a=!0)}),!1!==t){let e;e=a?{"org.w3.clearkey":t[1]}:{"com.widevine.alpha":t[1]},shakadata.shakaPlayer.configure({drm:{servers:e}})}}s.customCK&&!e&&0<Object.keys(s.customCK_data).length&&shakadata.shakaPlayer.configure({drm:{clearKeys:s.customCK_data}}),!1!==s.extra.clearkeys&&shakadata.shakaPlayer.configure(s.extra.clearkeys)}),a.searchParams.has("manifest_type")&&(t.playlist[0].sources[0].type=a.searchParams.get("manifest_type")),a.searchParams.has("title")&&(e=a.searchParams.get("title"),document.title=e,t.playlist[0].title=e),a.searchParams.has("image")&&(t.playlist[0].image=window.atob(a.searchParams.get("image")));let u=!1;function d(e){var r=document.querySelector("video");if(!0===e){let e,t,a,s;s=r._extension_source&&r._extension_compressor&&r._extension_gain?(e=r._extension_source.context,t=r._extension_source,a=r._extension_compressor,r._extension_gain):(e=new window.AudioContext,t=new window.MediaElementAudioSourceNode(e,{mediaElement:r}),a=new window.DynamicsCompressorNode(e),new window.GainNode(e,{gain:2})),a.threshold.value=-50,a.knee.value=40,a.ratio.value=12,a.attack.value=0,a.release.value=.25,t.connect(a),a.connect(s),s.connect(e.destination),r._extension_source=t,r._extension_compressor=a,r._extension_gain=s}else r._extension_source&&(r._extension_compressor.disconnect(),r._extension_gain.disconnect(),(e=r._extension_source).disconnect(),e.connect(e.context.destination))}function m(e){var t=document.createElement("template"),a=(t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon btn-compressor-off" viewBox="0 0 640 512"><path d="M352 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V480c0 17.7 14.3 32 32 32s32-14.3 32-32V32zM544 96c0-17.7-14.3-32-32-32s-32 14.3-32 32V416c0 17.7 14.3 32 32 32s32-14.3 32-32V96zM256 128c0-17.7-14.3-32-32-32s-32 14.3-32 32V384c0 17.7 14.3 32 32 32s32-14.3 32-32V128zm192 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V352c0 17.7 14.3 32 32 32s32-14.3 32-32V160zM160 224c0-17.7-14.3-32-32-32s-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32V224zM0 256a32 32 0 1 0 64 0A32 32 0 1 0 0 256zm576 0a32 32 0 1 0 64 0 32 32 0 1 0 -64 0z"/></svg>',document.createElement("template")),e=(a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon btn-compressor-on" viewBox="0 0 640 512"><path d="M320 0c12 0 22.1 8.8 23.8 20.7l42 304.4L424.3 84.2c1.9-11.7 12-20.3 23.9-20.2s21.9 8.9 23.6 20.6l28.2 197.3 20.5-102.6c2.2-10.8 11.3-18.7 22.3-19.3s20.9 6.4 24.2 16.9L593.7 264H616c13.3 0 24 10.7 24 24s-10.7 24-24 24H576c-10.5 0-19.8-6.9-22.9-16.9l-4.1-13.4-29.4 147c-2.3 11.5-12.5 19.6-24.2 19.3s-21.4-9-23.1-20.6L446.7 248.3l-39 243.5c-1.9 11.7-12.1 20.3-24 20.2s-21.9-8.9-23.5-20.7L320 199.6 279.8 491.3c-1.6 11.8-11.6 20.6-23.5 20.7s-22.1-8.5-24-20.2l-39-243.5L167.8 427.4c-1.7 11.6-11.4 20.3-23.1 20.6s-21.9-7.8-24.2-19.3l-29.4-147-4.1 13.4C83.8 305.1 74.5 312 64 312H24c-13.3 0-24-10.7-24-24s10.7-24 24-24H46.3l26.8-87.1c3.2-10.5 13.2-17.5 24.2-16.9s20.2 8.5 22.3 19.3l20.5 102.6L168.2 84.6c1.7-11.7 11.7-20.5 23.6-20.6s22 8.5 23.9 20.2l38.5 240.9 42-304.4C297.9 8.8 308 0 320 0z"/></svg>',e.currentTarget);e.querySelector("svg").classList.contains("btn-compressor-off")?(e.querySelector("svg").replaceWith(a.content.firstChild),e.querySelector(".jw-text").innerText=chrome.i18n.getMessage("player_compressor_turn_off"),d(!0)):(e.querySelector("svg").replaceWith(t.content.firstChild),e.querySelector(".jw-text").innerText=chrome.i18n.getMessage("player_compressor_turn_on"),d(!1))}a.searchParams.has("headers")&&(e=a.searchParams.get("headers"),e=window.atob(e),e=JSON.parse(e),e=Object.entries(e),Array.isArray(e))&&(u=[],e.forEach(e=>{var[e,t]=e;u.push({operation:"set",header:e,value:t})})),window.addEventListener("hashchange",()=>{location.reload()}),chrome.storage.local.get(null,e=>{"boolean"==typeof e.autoLowLatency&&(s.autoLowLatency=e.autoLowLatency),"string"==typeof e.audioLang&&(s.audioLang=e.audioLang),"boolean"==typeof e.compressorEnabled&&(s.compressorEnabled=e.compressorEnabled),"boolean"==typeof e.customWV&&(s.customWV=e.customWV),"string"==typeof e.customWV_data&&(s.customWV_data=e.customWV_data),"boolean"==typeof e.customCK&&(s.customCK=e.customCK),"object"==typeof e.customCK_data&&(s.customCK_data=e.customCK_data);let o=jwplayer("player");chrome.runtime.sendMessage({cmd:"updateHeadersRules",requestHeaders:u}).then(()=>{o.setup(t).on("ready",()=>{o.addButton('<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon btn-compressor-off" viewBox="0 0 640 512"><path d="M352 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V480c0 17.7 14.3 32 32 32s32-14.3 32-32V32zM544 96c0-17.7-14.3-32-32-32s-32 14.3-32 32V416c0 17.7 14.3 32 32 32s32-14.3 32-32V96zM256 128c0-17.7-14.3-32-32-32s-32 14.3-32 32V384c0 17.7 14.3 32 32 32s32-14.3 32-32V128zm192 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V352c0 17.7 14.3 32 32 32s32-14.3 32-32V160zM160 224c0-17.7-14.3-32-32-32s-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32V224zM0 256a32 32 0 1 0 64 0A32 32 0 1 0 0 256zm576 0a32 32 0 1 0 64 0 32 32 0 1 0 -64 0z"/></svg>',chrome.i18n.getMessage("player_compressor_turn_on"),m,"btn-compressor","btn-compressor"),document.querySelector(".jw-icon.jw-icon-volume").after(document.querySelector(".jw-icon.btn-compressor")),s.compressorEnabled&&document.querySelector(".jw-icon.btn-compressor").click()}).on("error",e=>{}).on("levels",r=>{document.querySelectorAll("#jw-player-settings-submenu-quality button").forEach((t,a)=>{if(0!==a){let e="";var s;"shaka"===o.getProvider().name&&"object"==typeof shakadata?(s=shakadata.shakaPlayer.getVariantTracks().find(e=>e.id===r.levels[a].shakaId))?.frameRate&&(e=" "+parseFloat(Number(s.frameRate).toFixed(2))+" fps"):"hlsjs"===o.getProvider().name&&"object"==typeof hlsdata&&(s=hlsdata.levelController.levels.at(r.levels[a].hlsjsIndex))?.attrs["FRAME-RATE"]&&(e=" "+parseFloat(Number(s.attrs["FRAME-RATE"]).toFixed(2))+" fps"),t.innerHTML=r.levels[a].height+"p ("+Math.floor(r.levels[a].bitrate/1e3)+" kbps"+e+")"}})})})})}("undefined"==typeof m3u&&(m3u={}));
